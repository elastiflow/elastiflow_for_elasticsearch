[
  {
    "job": {
      "job_id": "elastiflow_ecs_avail_dns_resp_ratio_low",
      "custom_settings": {
        "custom_urls": [
          {
            "url_name": "Core Services (DNS)",
            "url_value": "dashboards#/view/61bf2aa0-9b2b-11ec-a4df-e940aaa4214d?_g=(filters:!(('$state':(store:globalState),meta:(alias:!n,disabled:!f,index:'elastiflow-flow-ecs-*',key:server.ip,negate:!f,params:(query:'$server.ip$'),type:phrase),query:(match_phrase:(server.ip:'$server.ip$'))),('$state':(store:globalState),meta:(alias:!n,disabled:!f,index:'elastiflow-flow-ecs-*',key:network.transport,negate:!f,params:(query:'udp'),type:phrase),query:(match_phrase:(network.transport:'udp'))),('$state':(store:globalState),meta:(alias:!n,disabled:!f,index:'elastiflow-flow-ecs-*',key:server.port,negate:!f,params:(query:53),type:phrase),query:(match_phrase:(server.port:53)))),refreshInterval:(pause:!t,value:0),time:(mode:absolute,from:'$earliest$',to:'$latest$'))"
          },
          {
            "url_name": "Top Talkers",
            "url_value": "dashboards#/view/a000b640-3d3e-11eb-bc2c-c5758316d788?_g=(filters:!(('$state':(store:globalState),meta:(alias:!n,disabled:!f,index:'elastiflow-flow-ecs-*',key:server.ip,negate:!f,params:(query:'$server.ip$'),type:phrase),query:(match_phrase:(server.ip:'$server.ip$'))),('$state':(store:globalState),meta:(alias:!n,disabled:!f,index:'elastiflow-flow-ecs-*',key:network.transport,negate:!f,params:(query:'udp'),type:phrase),query:(match_phrase:(network.transport:'udp'))),('$state':(store:globalState),meta:(alias:!n,disabled:!f,index:'elastiflow-flow-ecs-*',key:server.port,negate:!f,params:(query:53),type:phrase),query:(match_phrase:(server.port:53)))),refreshInterval:(pause:!t,value:0),time:(mode:absolute,from:'$earliest$',to:'$latest$'))"
          },
          {
            "url_name": "Flow Records",
            "url_value": "dashboards#/view/bf9f8a70-3d3f-11eb-bc2c-c5758316d788?_g=(filters:!(('$state':(store:globalState),meta:(alias:!n,disabled:!f,index:'elastiflow-flow-ecs-*',key:server.ip,negate:!f,params:(query:'$server.ip$'),type:phrase),query:(match_phrase:(server.ip:'$server.ip$'))),('$state':(store:globalState),meta:(alias:!n,disabled:!f,index:'elastiflow-flow-ecs-*',key:network.transport,negate:!f,params:(query:'udp'),type:phrase),query:(match_phrase:(network.transport:'udp'))),('$state':(store:globalState),meta:(alias:!n,disabled:!f,index:'elastiflow-flow-ecs-*',key:server.port,negate:!f,params:(query:53),type:phrase),query:(match_phrase:(server.port:53)))),refreshInterval:(pause:!t,value:0),time:(mode:absolute,from:'$earliest$',to:'$latest$'))"
          }
        ]
      },
      "groups": [
        "elastiflow",
        "availability",
        "network_services"
      ],
      "description": "Low DNS Request/Response Ratio",
      "analysis_config": {
        "bucket_span": "20m",
        "summary_count_field_name": "doc_count",
        "detectors": [
          {
            "detector_description": "Low DNS Request/Response Ratio",
            "function": "low_mean",
            "field_name": "ratio",
            "partition_field_name": "server.ip",
            "detector_index": 0
          }
        ],
        "influencers": [
          "server.ip"
        ]
      },
      "analysis_limits": {
        "model_memory_limit": "256mb",
        "categorization_examples_limit": 4
      },
      "data_description": {
        "time_field": "@timestamp",
        "time_format": "epoch_ms"
      },
      "model_plot_config": {
        "enabled": true,
        "annotations_enabled": true
      },
      "model_snapshot_retention_days": 7,
      "daily_model_snapshot_retention_after_days": 1,
      "results_index_name": "custom-elastiflow_ecs_avail_dns_resp_ratio_low",
      "allow_lazy_open": false
    },
    "datafeed": {
      "datafeed_id": "datafeed-elastiflow_ecs_avail_dns_resp_ratio_low",
      "job_id": "elastiflow_ecs_avail_dns_resp_ratio_low",
      "chunking_config": {
        "mode": "auto"
      },
      "query": {
        "bool": {
          "must": [
            {
              "terms": {
                "event.dataset": [
                  "netflow",
                  "ipfix"
                ]
              }
            },
            {
              "term": {
                "network.transport": "udp"
              }
            },
            {
              "term": {
                "server.port": 53
              }
            },
            {
              "exists": {
                "field": "client.ip"
              }
            },
            {
              "exists": {
                "field": "server.ip"
              }
            }
          ],
          "must_not": [
            {
              "terms": {
                "client.ip": []
              }
            },
            {
              "terms": {
                "server.ip": []
              }
            }
          ]
        }
      },
      "indices": [
        "elastiflow-flow-ecs-*"
      ],
      "aggregations": {
        "buckets": {
          "date_histogram": {
            "field": "@timestamp",
            "fixed_interval": "20m",
            "time_zone": "UTC"
          },
          "aggregations": {
            "@timestamp": {
              "max": {
                "field": "@timestamp"
              }
            },
            "server.ip": {
              "terms": {
                "field": "server.ip",
                "size": 20000
              },
              "aggregations": {
                "requests": {
                  "filter": {
                    "term": {
                      "destination.port": 53
                    }
                  },
                  "aggregations": {
                    "packets": {
                      "sum": {
                        "field": "network.packets"
                      }
                    }
                  }
                },
                "responses": {
                  "filter": {
                    "term": {
                      "source.port": 53
                    }
                  },
                  "aggregations": {
                    "packets": {
                      "sum": {
                        "field": "network.packets"
                      }
                    }
                  }
                },
                "ratio": {
                  "bucket_script": {
                    "buckets_path": {
                      "requests": "requests.packets",
                      "responses": "responses.packets"
                    },
                    "script": "if(params.requests>0){params.responses/params.requests}else{1}"
                  }
                }
              }
            }
          }
        }
      },
      "scroll_size": 1000,
      "delayed_data_check_config": {
        "enabled": true
      }
    }
  }
]